<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cucina - Voice Call System</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-utensils"></i> Cucina</h1>
            <p class="subtitle">Kitchen Communication System</p>
        </header>

        <div class="call-interface">
            <div class="status-section">
                <div class="status-indicator" id="connectionStatus">
                    <i class="fas fa-circle"></i>
                    <span id="statusText">Disconnected</span>
                </div>
                <div class="call-status" id="callStatus">Ready to call</div>
            </div>

            <div class="controls-section">
                <button id="callButton" class="btn btn-call" onclick="fallbackInitiateCall()">
                    <i class="fas fa-phone"></i>
                    Call Pizzeria
                </button>

                <button id="hangupButton" class="btn btn-hangup" onclick="fallbackEndCall()" disabled>
                    <i class="fas fa-phone-slash"></i>
                    End Call
                </button>

                <button id="muteButton" class="btn btn-mute" onclick="fallbackToggleMute()" disabled>
                    <i class="fas fa-microphone"></i>
                    Mute
                </button>
            </div>

            <div class="volume-section">
                <label for="volumeSlider">Volume:</label>
                <input type="range" id="volumeSlider" min="0" max="100" value="80" onchange="adjustVolume(this.value)">
                <span id="volumeValue">80%</span>
            </div>

            <div class="incoming-call" id="incomingCall" style="display: none;">
                <div class="incoming-call-content">
                    <h3><i class="fas fa-phone-volume"></i> Incoming Call from Pizzeria</h3>
                    <div class="incoming-call-buttons">
                        <button class="btn btn-accept" onclick="fallbackAcceptCall()">
                            <i class="fas fa-phone"></i>
                            Accept
                        </button>
                        <button class="btn btn-decline" onclick="declineCall()">
                            <i class="fas fa-phone-slash"></i>
                            Decline
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="info-section">
            <h3>Call Logs</h3>
            <div class="call-logs" id="callLogs">
                <p class="no-logs">No recent calls</p>
            </div>
        </div>
    </div>

    <!-- Agora Web SDK -->
    <script src="https://cdn.agora.io/sdk/release/AgoraRTC_N-4.19.0.js"></script>
    <script>
        // Set Agora configuration from server
        fetch('/api/config')
            .then(response => response.json())
            .then(config => {
                window.AGORA_APP_ID = config.agoraAppId;
                window.AGORA_CONFIG = config;
                console.log('Loaded Agora config:', config);
            })
            .catch(error => {
                console.error('Failed to load config:', error);
            });
    </script>
    <script src="js/agora-fallback.js"></script>
    <script src="js/agora-client.js"></script>
    <script>
        // Initialize the page as 'cucina'
        window.addEventListener('DOMContentLoaded', function() {
            // Initialize fallback system
            window.fallbackVoiceCall.initialize('cucina');

            // Also try Agora if available
            setTimeout(() => {
                initializeAgoraClient('cucina');
            }, 500);
        });
    </script>
</body>
</html>
