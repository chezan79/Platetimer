<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Abbonamento - Sistema Gestione Ordini</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        .subscription-container {
            max-width: 600px;
            margin: 50px auto;
            padding: 30px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .plan-card {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .plan-card:hover {
            border-color: #007bff;
            box-shadow: 0 2px 10px rgba(0,123,255,0.2);
        }
        .plan-card.selected {
            border-color: #007bff;
            background: #f8f9ff;
        }
        .plan-price {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .features-list {
            list-style: none;
            padding: 0;
        }
        .features-list li {
            padding: 5px 0;
            color: #666;
        }
        .features-list li::before {
            content: "‚úÖ ";
            margin-right: 8px;
        }
        .subscribe-btn {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }
        .subscribe-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="subscription-container">
        <div style="background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px; padding: 15px; margin-bottom: 20px; text-align: center;">
            <h3 style="color: #856404; margin: 0;">‚ö†Ô∏è Abbonamenti Temporaneamente Disabilitati</h3>
            <p style="color: #856404; margin: 10px 0 0 0;">L'app √® attualmente in modalit√† test. Tutte le funzionalit√† sono disponibili gratuitamente.</p>
        </div>
        <h1>üéØ Scegli il tuo Piano</h1>
        <p>Seleziona il piano pi√π adatto per la tua attivit√†</p>

        <!-- Piano Base Gratuito -->
        <div class="plan-card" data-plan="free">
            <h3>üì± Piano Base</h3>
            <div class="plan-price">Gratuito</div>
            <ul class="features-list">
                <li>Fino a 10 tavoli</li>
                <li>Countdown base</li>
                <li>1 destinazione</li>
                <li>Supporto email</li>
            </ul>
        </div>

        <!-- Piano Premium -->
        <div class="plan-card" data-plan="premium">
            <h3>‚≠ê Piano Premium</h3>
            <div class="plan-price">‚Ç¨29.99/mese</div>
            <ul class="features-list">
                <li>Tavoli illimitati</li>
                <li>Messaggi vocali</li>
                <li>Tutte le destinazioni (cucina, pizzeria, insalata)</li>
                <li>Riconoscimento vocale</li>
                <li>Funzione pausa</li>
                <li>Statistiche avanzate</li>
                <li>Supporto prioritario</li>
            </ul>
        </div>

        <!-- Piano Business -->
        <div class="plan-card" data-plan="business">
            <h3>üè¢ Piano Business</h3>
            <div class="plan-price">‚Ç¨79.99/mese</div>
            <ul class="features-list">
                <li>Tutto del Piano Premium</li>
                <li>Multi-location</li>
                <li>API personalizzate</li>
                <li>Integrazione POS</li>
                <li>Analytics dettagliati</li>
                <li>Supporto telefonico 24/7</li>
            </ul>
        </div>

        <button id="subscribe-btn" class="subscribe-btn" disabled>
            Seleziona un Piano
        </button>

        <div id="user-info" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
            <p><strong>Utente:</strong> <span id="user-name">-</span></p>
            <p><strong>Email:</strong> <span id="user-email">-</span></p>
            <p><strong>Azienda:</strong> <span id="user-company">-</span></p>
            <p><strong>Piano Attuale:</strong> <span id="current-plan">Base Gratuito</span></p>
        </div>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc, updateDoc, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Configurazione Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDZ0FdjenO-ngblcuXKdwWwvRV5liiR18I",
            authDomain: "app-dati-tavoli.firebaseapp.com",
            projectId: "app-dati-tavoli",
            storageBucket: "app-dati-tavoli.appspot.com",
            messagingSenderId: "267339065819",
            appId: "1:267339065819:web:1e74647f740bdf1d725ffe"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Abbonamenti temporaneamente disabilitati
        let currentUser = null;

        // Verifica autenticazione
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = 'index.html';
                return;
            }

            currentUser = user;

            // Verifica se l'utente ha gi√† accesso
            const userDoc = await getDoc(doc(db, "users", user.uid));
            if (userDoc.exists()) {
                const userData = userDoc.data();
                 document.getElementById('user-name').textContent = userData.firstName + ' ' + userData.lastName;
                document.getElementById('user-email').textContent = userData.email;
                document.getElementById('user-company').textContent = userData.company || 'Non specificata';
                document.getElementById('current-plan').textContent = userData.subscriptionPlan || 'Base Gratuito';


                // Se ha gi√† dati, vai direttamente alla home
                if (userData.companyName) {
                    window.location.href = 'home.html';
                    return;
                }
            }
        });

        // Funzione per accesso diretto all'app
        function accessApp() {
            if (!currentUser) {
                alert('Errore: utente non autenticato');
                return;
            }

            // Crea/aggiorna dati utente con accesso completo
            setDoc(doc(db, "users", currentUser.uid), {
                email: currentUser.email,
                firstName: currentUser.email.split('@')[0],
                lastName: "user",
                company:  currentUser.email.split('@')[0],
                subscriptionPlan: 'test',
                subscriptionStatus: 'active', // Temporaneamente attivo
                createdAt: new Date(),
                updatedAt: new Date()
            }).then(() => {
                alert('‚úÖ Accesso concesso! Benvenuto in MealMaster');
                window.location.href = 'home.html';
            }).catch((error) => {
                console.error('Errore:', error);
                alert('Errore durante l\'attivazione. Riprova.');
            });
        }
         document.getElementById('subscribe-btn').addEventListener('click',  () => {
             accessApp();
         });
    </script>
</body>
</html>